```

Redis实例需要装载大量用户在短时间内产生的数据，数以百万的keys需要快速的创建。

从redis2.6开始支持redis-cli支持一种新的称之为pipe mode的新模式用于执行大量数据插入工作。

使用pipe mode模式的执行命令如下：
    cat data.txt | redis-cli --pipe

redis-cli有效的确保错误输出到Redis实例的标准输出里面。

生成Redis协议
    它会非常简单的生成和解析Redis协议

pipe mode的工作原理是什么？
    难点是保证redis-cli在pipe mode模式下执行和netcat一样快的同时，如何能理解服务器发送的最后一个回复。

    通过以下方式获得：
        redis-cli -pipe试着尽可能快的发送数据到服务器。
        读取数据的同时，解析它。
        一旦没有更多的数据输入，它就会发送一个特殊的ECHO命令，后面跟着20个随机的字符，我们相信可以通过匹配回复相同的20个字符是同一个命令的行为。
        一旦这个特殊命令发出，收到的答复就开始匹配这20个字符，当匹配时，就可以成功退出了。

    同时，在分析回复的时候，我们会采用计数器的方法计数，以便在最后能够告诉我们大量插入数据的数据流。


```